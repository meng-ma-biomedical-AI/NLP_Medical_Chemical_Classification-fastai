kind: job
metadata:
  name: hyper-param-lm-search
  tag: ''
  hash: 5895a2d9350511d1d3fd813cbb1eda033b323799
  project: default
  labels:
    author: nschenone
  categories:
  - hyperparameter
  - ml
spec:
  command: ''
  args: []
  image: mlrun/ml-models-gpu
  env: []
  resources:
    limits:
      nvidia.com/gpu: 1
  default_handler: train_lm_model
  entry_points:
    get_min_grad:
      name: get_min_grad
      doc: ''
      parameters:
      - name: model
        default: ''
      outputs:
      - default: ''
      lineno: 13
    train_lm_model:
      name: train_lm_model
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 18
  description: hyperparameter tuning for language model
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKZnJvbSBvcyBpbXBvcnQgcGF0aAppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgcmFuZG9tCmltcG9ydCBmYXN0YWkKaW1wb3J0IGpzb24KZnJvbSBmYXN0YWkudGV4dCBpbXBvcnQgKgpmcm9tIGZhc3RhaS5jYWxsYmFja3MgaW1wb3J0ICoKdG9yY2guY3VkYS5zZXRfZGV2aWNlKDApCgpkZWYgZ2V0X21pbl9ncmFkKG1vZGVsKToKICAgIG1vZGVsLmxyX2ZpbmQobnVtX2l0PTIwMCkKICAgIG1vZGVsLnJlY29yZGVyLnBsb3Qoc3VnZ2VzdGlvbj1UcnVlKQogICAgcmV0dXJuIG1vZGVsLnJlY29yZGVyLm1pbl9ncmFkX2xyCgpkZWYgdHJhaW5fbG1fbW9kZWwoY29udGV4dCk6CiAgICBicyA9IGludChjb250ZXh0LmdldF9wYXJhbSgnYnMnKSkKICAgIGRyb3BfbXVsdCA9IGZsb2F0KGNvbnRleHQuZ2V0X3BhcmFtKCdkcm9wX211bHQnKSkKICAgIGVwb2NocyA9IGludChjb250ZXh0LmdldF9wYXJhbSgnZXBvY2hzJykpCiAgICBudW1fc2FtcGxlcyA9IGludChjb250ZXh0LmdldF9wYXJhbSgnbnVtX3NhbXBsZXMnKSkKICAgIGRhdGFfbG1fcGF0aCA9IGNvbnRleHQuZ2V0X3BhcmFtKCdkYXRhX2xtX3BhdGgnKQogICAgCiAgICB2ZXJzaW9uID0gZiJzYW1wbGVfe251bV9zYW1wbGVzfSIKICAgIGRhdGFfbG0gPSBsb2FkX2RhdGEoIiIsIGRhdGFfbG1fcGF0aCwgYnM9YnMpCgogICAgbWV0cmljcyA9IFthY2N1cmFjeV0KCiAgICBlYXJseV9zdG9wID0gcGFydGlhbChFYXJseVN0b3BwaW5nQ2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yPSdhY2N1cmFjeScsCiAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlPSJtYXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgbWluX2RlbHRhPTAuMDEsCiAgICAgICAgICAgICAgICAgICAgICAgICBwYXRpZW5jZT01KQogICAgZ3JhcGggPSBTaG93R3JhcGgKICAgIGNhbGxiYWNrX2ZucyA9IFtlYXJseV9zdG9wXQoKICAgIGxlYXJuX2xtID0gbGFuZ3VhZ2VfbW9kZWxfbGVhcm5lcihkYXRhX2xtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFXRF9MU1RNLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BfbXVsdD1kcm9wX211bHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcz1tZXRyaWNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrX2Zucz1jYWxsYmFja19mbnMpLnRvX2ZwMTYoKQogICAgCiAgICBtb2RlbF9uYW1lID0gZiJsZWFybl9sbV97dmVyc2lvbn1fYnNfe2JzfV9kcm9wbXVsdF97ZHJvcF9tdWx0fSIKICAgIG1vZGVsX2VuY19uYW1lID0gZiJsZWFybl9sbV9lbmNfe3ZlcnNpb259X2JzX3tic31fZHJvcG11bHRfe2Ryb3BfbXVsdH0iCiAgICBzYXZlX2Jlc3QgPSBTYXZlTW9kZWxDYWxsYmFjayhsZWFybl9sbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZXJ5PSdpbXByb3ZlbWVudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yPSJhY2N1cmFjeSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlPSJtYXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1tb2RlbF9uYW1lKQogICAgY2FsbGJhY2tzID0gW3NhdmVfYmVzdF0KCiAgICBtaW5fZ3JhZCA9IGdldF9taW5fZ3JhZChsZWFybl9sbSkKICAgIGxlYXJuX2xtLmZpdF9vbmVfY3ljbGUoMSwgbWluX2dyYWQsIGNhbGxiYWNrcz1jYWxsYmFja3MpCiAgICBsZWFybl9sbS51bmZyZWV6ZSgpCgogICAgbWluX2dyYWQgPSBnZXRfbWluX2dyYWQobGVhcm5fbG0pCiAgICBsZWFybl9sbS5maXRfb25lX2N5Y2xlKGVwb2Nocywgc2xpY2UobWluX2dyYWQsbWluX2dyYWQqMTAwKSwgbW9tcz0oMC44LDAuNyksIGNhbGxiYWNrcz1jYWxsYmFja3MpCiAgICAKICAgIGJlc3RfYWNjID0gbWF4KFtpWzBdIGZvciBpIGluIGxlYXJuX2xtLnJlY29yZGVyLm1ldHJpY3NdKS5pdGVtKCkKCiAgICBwYXJhbXMgPSB7ImJzIjogYnMsICJkcm9wX211bHQiIDogZHJvcF9tdWx0LCAiZXBvY2hzIiA6IGVwb2Noc30KICAgIAogICAgY29udGV4dC5sb2dfcmVzdWx0KCdhY2N1cmFjeScsIGJlc3RfYWNjKQogICAgY29udGV4dC5sb2dfbW9kZWwoImJlc3RfcGFyYW1zIiwgYm9keT1qc29uLmR1bXBzKHBhcmFtcywgaW5kZW50PTIpLmVuY29kZSgndXRmLTgnKSwKICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9Y29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKCdtb2RlbHMnKSwKICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX2ZpbGU9InBhcmFtcy5qc29uIikKCg==
    commands: []
    code_origin: https://github.com/nschenone/NLP_Dev.git#10629776eea268f5080b9e2187a89f53f13a6575:hyper_param_lm_search.ipynb
